(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[105],{353:e=>{e.exports={wrapper:"PublicMessages_wrapper__5vy0Q",list:"PublicMessages_list__1_S1S",item:"PublicMessages_item__F2IEE",meta:"PublicMessages_meta__HZlEa",from:"PublicMessages_from__4zztK",to:"PublicMessages_to__3yZ6M",text:"PublicMessages_text__7L5GI"}},1058:(e,s,a)=>{Promise.resolve().then(a.bind(a,2499))},2499:(e,s,a)=>{"use strict";a.r(s),a.d(s,{default:()=>x});var t=a(5155),r=a(2115),n=a(7832),l=a(353),c=a.n(l);function i(){let[e,s]=(0,r.useState)([]);return(0,r.useEffect)(()=>{(async()=>{try{var e;let a=await (0,n.Mw)();s(null!=(e=a.result)?e:[])}catch(e){console.error("❌ Failed to fetch public messages:",e)}})()},[]),(0,t.jsx)("div",{className:c().wrapper,children:(0,t.jsx)("ul",{className:c().list,children:e.map((e,s)=>(0,t.jsxs)("li",{className:c().item,children:[(0,t.jsxs)("div",{className:c().meta,children:[(0,t.jsx)("span",{className:c().from,children:e.from}),(0,t.jsxs)("span",{className:c().to,children:["→ ",e.to]})]}),(0,t.jsx)("div",{className:c().text,children:e.message})]},s))})})}var o=a(3417),d=a.n(o);function u(){let[e,s]=(0,r.useState)([]);return(0,r.useEffect)(()=>{(async()=>{try{var e;let a=await (0,n.cC)();s(null!=(e=a.result)?e:[])}catch(e){console.error("❌ Failed to fetch private messages:",e)}})()},[]),(0,t.jsx)("div",{className:d().wrapper,children:(0,t.jsx)("ul",{className:d().list,children:e.map((e,s)=>(0,t.jsxs)("li",{className:d().item,children:[(0,t.jsxs)("div",{className:d().meta,children:[(0,t.jsx)("span",{className:d().from,children:e.from}),(0,t.jsxs)("span",{className:d().to,children:["→ ",e.to]})]}),(0,t.jsx)("div",{className:d().text,children:e.message})]},s))})})}var _=a(4793),h=a.n(_);function g(){let[e,s]=(0,r.useState)("0x0"),[a,l]=(0,r.useState)(""),[c,i]=(0,r.useState)(!1),[o,d]=(0,r.useState)(null),u=async()=>{d("sending…");try{let s=await (0,n._z)({to:e,message:a,shouldBeEncrypted:c});d(s.success?"sent ✅":"error: "+s.result),s.success&&l("")}catch(e){d("network error")}};return(0,t.jsxs)("div",{className:h().form,children:[(0,t.jsx)("input",{value:e,onChange:e=>s(e.target.value),className:h().input,placeholder:"Recipient (address)"}),(0,t.jsx)("textarea",{value:a,onChange:e=>l(e.target.value),className:h().textarea,rows:3,placeholder:"Your message"}),(0,t.jsxs)("label",{className:h().chk,children:[(0,t.jsx)("input",{type:"checkbox",checked:c,onChange:e=>i(e.target.checked)}),"encrypt"]}),(0,t.jsx)("button",{className:h().button,onClick:u,children:"Send"}),o&&(0,t.jsx)("p",{className:h().status,children:o})]})}var m=a(5333),p=a.n(m);function x(){let[e,s]=(0,r.useState)("guest");(0,r.useEffect)(()=>{s((0,n.TO)())},[]);let a="guest"===e;return(0,t.jsx)("div",{className:p().page,children:(0,t.jsxs)("div",{className:p().card,children:[(0,t.jsxs)("header",{className:p().header,children:["hello,\xa0",(0,t.jsx)("strong",{children:e})]}),(0,t.jsxs)("section",{className:p().section,children:[(0,t.jsx)("h3",{children:"\uD83C\uDF10 Public messages"}),(0,t.jsx)(i,{})]}),a?(0,t.jsx)("p",{className:p().note,children:"Log in to view private inbox & send messages"}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("section",{className:p().section,children:[(0,t.jsx)("h3",{children:"\uD83D\uDD12 Your private messages"}),(0,t.jsx)(u,{})]}),(0,t.jsxs)("section",{className:p().section,children:[(0,t.jsx)("h3",{children:"✉️ Send a message"}),(0,t.jsx)(g,{})]})]})]})})}},3417:e=>{e.exports={wrapper:"PrivateMessages_wrapper__Nu_gF",list:"PrivateMessages_list__Ubth1",item:"PrivateMessages_item__AgXG9",meta:"PrivateMessages_meta__QVxX1",from:"PrivateMessages_from__yfd4D",to:"PrivateMessages_to__QY5rz",text:"PrivateMessages_text__A9Ot3"}},4793:e=>{e.exports={form:"SendMessageForm_form__98e_4",input:"SendMessageForm_input__guEGA",textarea:"SendMessageForm_textarea__suTvA",chk:"SendMessageForm_chk__BsjYc",button:"SendMessageForm_button__ZHoAh",status:"SendMessageForm_status__aWQf7"}},5333:e=>{e.exports={page:"DashboardPage_page__VBY6I",flow:"DashboardPage_flow__4_bv4",card:"DashboardPage_card__CGhWH",header:"DashboardPage_header__lKhIz",section:"DashboardPage_section__cWM8F",note:"DashboardPage_note__Y3QKr",loader:"DashboardPage_loader__UfjZf"}},7832:(e,s,a)=>{"use strict";a.d(s,{Mw:()=>r,TO:()=>t,_z:()=>l,cC:()=>n,iD:()=>c,kz:()=>i});let t=()=>{var e;return null!=(e=localStorage.getItem("username"))?e:"guest"},r=async()=>{try{let e=await fetch("/anon/getMessages"),s=await e.json();return console.log("public",s),s}catch(e){throw console.error("❌ getPublicMessages error:",e),e}},n=async()=>{let e=await fetch("/api/getMessages",{credentials:"include"}),s=await e.json();return console.log("private",s),s},l=async e=>{let{to:s,message:a,shouldBeEncrypted:t=!1}=e,r=await fetch("/api/addRecord",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({to:s,message:a,shouldBeEncrypted:t})});return console.log("\uD83D\uDCE4 Send message status:",r.status),r.json()},c=async e=>{let{username:s,password:a}=e,t=await fetch("/auth/login",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({username:s,password:a})});console.log("\uD83D\uDD01 Login response status:",t.status);let r=await t.json();return console.log("✅ Login response:",r),r},i=async e=>{let{username:s,password:a,privateKey:t,publicKey:r}=e,n=await fetch("/auth/register",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:s,password:a,privateKey:t,publicKey:r})});return console.log("\uD83D\uDCDD Register response status:",n.status),n.json()}}},e=>{var s=s=>e(e.s=s);e.O(0,[729,441,684,358],()=>s(1058)),_N_E=e.O()}]);